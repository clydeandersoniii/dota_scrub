<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/templates/styles.css">
    <title>Dota Scrubner</title>
</head>

<div class='settings'>
    <label id='rangelabel'>Time Range:</label>
    <select id='range'>
        <!--dates = ['week','month','3month','6month','year']-->
        <option value="1">1 Week</option>
        <option value="2">1 Month</option>
        <option value="3">3 Months</option>
        <option value="4">6 Months</option>
        <option value="5">1 Year</option>
    </select>
</div>
<br /><br />
<div class='team' side='team'>
    <button side='team' onclick='addHero("team")'>Add Hero</button>
    <table id='team' side='team'>
        <tr id='header'>
            <th>Your Team</th>
        </tr>
    </table>
</div>
<div class='opponent' side='team'>
    <button side='team' onclick='addHero("opponent")'>Add Hero</button>
    <table id='opponent' side='team'>
        <tr id='header'>
            <th>Opponent Team</th>
        </tr>
    </table>
</div>
<br /><br /><br /><br /><br /><br />
<div class='heroinfo' side='team'>FUCK</div>

<script>
    addHero.counter = 0;
    arrHeroes = []

    function addHero(side) {
        $.ajax({
            'url': 'https://api.opendota.com/api/heroes',
            'type': 'GET',
            'success': function (data) {
                console.log(data)

                //Sort alphabetically
                data.sort((a, b) => (a.localized_name > b.localized_name) ? 1 : -1)

                //Create all options items for the dropdown
                options = "<option disabled selected value> -- select an option -- </option>"
                for (hero in data) {
                    options += "<option value='" + data[hero].localized_name + "'>" + data[hero].localized_name + "</option>"
                }
                identifiers = "side='" + side + "' class='hero" + addHero.counter + "'"
                divStart = "<div " + identifiers + ">"
                selector = "<select " + identifiers + " onchange='setHero(" + addHero.counter + ")'" + ">" + options + "</select>";
                deleteButton = "<button " + identifiers + " onclick='deleteElement(" + addHero.counter + ")'>Delete</button>";
                infoButton = "<button " + identifiers + " btnId='" + addHero.counter + "' style='visibility:hidden' onclick='getHeroInfo(" + addHero.counter + ")'>Info</button>";
                linebreak = "<" + identifiers + " br />";
                divEnd = "</div>"
                addHero.counter++;

                $('#' + side).append(divStart + selector + deleteButton + infoButton + linebreak + divEnd);
            },
        });
    }

    function deleteElement(id) {
        $('.hero' + id).remove();
    }

    function setHero(id) {
        heroName = String($('select.hero' + id).val()).replace(' ','_').replace('-','').toLowerCase()
        $('div.hero' + id).prepend("<img class='heroimg' src='http://cdn.dota2.com/apps/dota2/images/heroes/" + heroName + "_sb.png'>")
        $('select.hero' + id).prop('disabled', true);
        $('[btnId='+ id + ']').css('visibility','visible')
    }

    function getHeroInfo(id) {
        //http://18.218.105.177:5200/api/v1/dotahero?hero=invoker&range=2
        url = "http://18.218.105.177:5200/api/v1/dotahero?"
        hero = "hero=\"" + $('select.hero' + id).val() + "\""
        range = "range=" + $('#range').val()
        fullURL = url + hero + "&" + range
        
        console.log(fullURL)

        $.ajax({
            'url': fullURL,
            'type':'GET',
            'success': function (data) {
                console.log(data);

                $('.heroinfo').empty();

                jsonData = JSON.parse(data)
                header = "<h1>" + String(jsonData.hero).toUpperCase() + "</h1>"
                lineBreak = "<br />"

                //COUNTERS
                hdrCounters = "<h2>Counters</h2>"
                tblCountersStart = "<table class='counters'>"
                tblCountersHead = "<tr><th></th><th class='heroname'>Hero</th><th class='herodata'>Advantage</th><th class='herodata'>Win Rate</th></tr>"
                tblCountersBody = ""
                jsonData.counters.forEach(item => {
                    heroName = String(item.hero).replace(' ','_').replace('-','').toLowerCase()
                    tblCountersBody += "<tr><td><img class='heroimg' src='http://cdn.dota2.com/apps/dota2/images/heroes/" + heroName + "_full.png'></td>" + 
                        "<td class='heroname'>" + String(item.hero).toUpperCase() + 
                        "</td><td class='herodata'>" + item.advantage + 
                        "</td><td class='herodata'>" + item.winrate + "</td></tr>"
                })
                tblCountersEnd = "</table>"

                counters = hdrCounters + tblCountersStart + tblCountersHead + tblCountersBody + tblCountersEnd

                //COUNTERED BY
                hdrCountered = "<h2>Countered By</h2>"
                tblCounteredStart = "<table class='countered'>"
                tblCounteredHead = "<tr><th></th><th class='heroname'>Hero</th><th class='herodata'>Disadvantage</th><th class='herodata'>Win Rate</th></tr>"
                tblCounteredBody = ""
                jsonData.countered.forEach(item => {
                    heroName = String(item.hero).replace(' ','_').replace('-','').toLowerCase()
                    tblCounteredBody += "<tr><td><img class='heroimg' src='http://cdn.dota2.com/apps/dota2/images/heroes/" + heroName + "_full.png'></td>" + 
                        "<td class='heroname'>" + String(item.hero).toUpperCase() + 
                        "</td><td class='herodata'>" + item.disadvantage + 
                        "</td><td class='herodata'>" + item.winrate + "</td></tr>"
                })
                tblCounteredEnd = "</table>"

                countered = hdrCountered + tblCounteredStart + tblCounteredHead + tblCounteredBody + tblCounteredEnd

                $('.heroinfo').html(header + lineBreak + counters + lineBreak + countered);
            }
        })
    }
</script>

<style>
    .heroinfo {
        border: 1px solid black;
        margin: auto;
        text-align: center;
    }

    .opponent, .team {
        display:inline-block;
    }

    .opponent {
        float:right;
    }

    table {
        margin: auto;
    }

    .heroname {
        text-align:left;
    }

    .herodata {
        text-align:right;
    }

    #team, #opponent {
        text-align:right;
    }

    #header {
        text-align:center;
    }

    .heroinfo img {
        width: 25%;
        height: auto;
        text-align: left;
    }
</style>

</html>